{% extends "base.html" %}

{% block content %}
<link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap"
    rel="stylesheet">

<style>
    :root {
        --terminal-bg: #030712;
        --accent-primary: #6366f1;
        --accent-secondary: #a855f7;
        --accent-emerald: #10b981;
        --accent-amber: #f59e0b;
        --accent-rose: #ef4444;
        --glass-bg: rgba(15, 23, 42, 0.7);
        --glass-border: rgba(255, 255, 255, 0.1);
        --text-main: #f8fafc;
        --text-dim: #94a3b8;
        --hero-dark-bg: #030712;
    }

    body {
        background: var(--terminal-bg);
        color: var(--text-main);
        font-family: 'Outfit', sans-serif;
        overflow-x: hidden;
    }

    /* --- Background Layer --- */
    .premium-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 50% 50%, #0f172a 0%, #020617 100%);
        z-index: -2;
    }

    .network-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0.3;
        pointer-events: none;
        z-index: -1;
    }

    /* --- Page Layout --- */
    .analytics-wrapper {
        max-width: 1400px;
        margin: 0 auto;
        padding: 100px 2rem 4rem;
    }

    .hero-terminal {
        background: rgba(15, 23, 42, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 32px;
        padding: 50px;
        margin-bottom: 3rem;
        backdrop-filter: blur(20px);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .matrix-title {
        font-size: 3.5rem;
        font-weight: 800;
        background: linear-gradient(to right, #fff, #94a3b8);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        letter-spacing: -1.5px;
        line-height: 1.1;
        margin-bottom: 10px;
    }

    .matrix-badge {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        background: rgba(99, 102, 241, 0.1);
        padding: 8px 16px;
        border-radius: 50px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--accent-primary);
        margin-bottom: 25px;
        border: 1px solid rgba(99, 102, 241, 0.2);
    }

    /* --- Matrix Cards --- */
    .glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        border-radius: 28px;
        padding: 35px;
        height: 100%;
        transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .glass-card:hover {
        transform: translateY(-8px);
        border-color: var(--accent-primary);
        background: rgba(15, 23, 42, 0.85);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    .stat-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        margin-bottom: 25px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        color: var(--accent-primary);
        transition: 0.3s;
    }

    .glass-card:hover .stat-icon {
        background: var(--accent-primary);
        color: white;
        transform: rotate(-5deg) scale(1.1);
    }

    .stat-value {
        font-family: 'JetBrains Mono', monospace;
        font-weight: 800;
        font-size: 3rem;
        line-height: 1;
        margin-bottom: 8px;
        color: white;
        display: block;
    }

    .stat-label {
        font-size: 0.75rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: var(--text-dim);
    }

    /* --- Density Bars --- */
    .density-node {
        margin-bottom: 30px;
    }

    .density-label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        font-weight: 700;
        font-size: 0.9rem;
    }

    .density-target {
        font-family: 'JetBrains Mono', monospace;
        color: var(--text-dim);
        font-size: 0.8rem;
    }

    .progress-track {
        background: rgba(255, 255, 255, 0.03);
        height: 8px;
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .progress-fill {
        height: 100%;
        border-radius: 10px;
        width: 0%;
        transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: progressShine 2s infinite linear;
    }

    @keyframes progressShine {
        0% {
            transform: translateX(-100%);
        }

        100% {
            transform: translateX(100%);
        }
    }

    /* --- Action Items --- */
    .action-btn {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        padding: 18px 25px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        color: white;
        text-decoration: none;
        font-weight: 700;
        transition: 0.3s;
        margin-bottom: 15px;
    }

    .action-btn i {
        font-size: 1.2rem;
        transition: 0.3s;
    }

    .action-btn:hover {
        background: rgba(99, 102, 241, 0.1);
        border-color: var(--accent-primary);
        color: white;
        transform: translateX(10px);
    }

    .action-btn:hover i {
        transform: scale(1.2);
    }

    .nexus-info {
        background: rgba(99, 102, 241, 0.05);
        border: 1px solid rgba(99, 102, 241, 0.1);
        border-radius: 24px;
        padding: 25px;
        margin-bottom: 30px;
    }

    /* --- Navbar Overrides for Visibility --- */
    #mainNavbar .user-name {
        color: #0f172a !important;
        font-weight: 700;
    }

    #mainNavbar .nav-link {
        color: #1e293b !important;
    }

    #mainNavbar .brand-premium strong {
        color: #2291c1 !important;
    }

    /* Fix dropdown header text */
    .dropdown-header-custom {
        color: #0f172a !important;
    }

    .dropdown-header-custom span,
    .dropdown-header-custom strong {
        color: #0f172a !important;
    }

    /* --- Animations --- */
    .fade-up {
        animation: fadeUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        opacity: 0;
    }

    @keyframes fadeUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<div class="premium-bg"></div>
<canvas id="networkCanvas" class="network-canvas"></canvas>

<div class="analytics-wrapper">
    <!-- Hero Section -->
    <div class="hero-terminal fade-up">
        <div class="matrix-badge">
            <i class="fas fa-satellite-dish pulse-dot"></i>
            SYSTEM_TELEMETRY_SCAN // ACTIVE
        </div>
        <h1 class="matrix-title">Ecosystem Analytics</h1>
        <p class="text-dim fs-5 fw-bold mb-0">High-fidelity operational intelligence and segment telemetry across the
            university network nodes.</p>
    </div>

    <!-- Stats Grid -->
    <div class="row g-4 mb-5">
        <div class="col-md-3 col-6 fade-up" style="animation-delay: 0.1s;">
            <div class="glass-card">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <span class="stat-value">{{ stats['total_users'] }}</span>
                <span class="stat-label">Collective Units</span>
            </div>
        </div>
        <div class="col-md-3 col-6 fade-up" style="animation-delay: 0.2s;">
            <div class="glass-card">
                <div class="stat-icon" style="color: var(--accent-emerald);"><i class="fas fa-award"></i></div>
                <span class="stat-value" style="color: var(--accent-emerald);">{{ stats['alumni'] }}</span>
                <span class="stat-label">Legacy Nodes</span>
            </div>
        </div>
        <div class="col-md-3 col-6 fade-up" style="animation-delay: 0.3s;">
            <div class="glass-card">
                <div class="stat-icon" style="color: var(--accent-primary);"><i class="fas fa-user-graduate"></i></div>
                <span class="stat-value" style="color: var(--accent-primary);">{{ stats['students'] }}</span>
                <span class="stat-label">Active Learners</span>
            </div>
        </div>
        <div class="col-md-3 col-6 fade-up" style="animation-delay: 0.4s;">
            <div class="glass-card">
                <div class="stat-icon" style="color: var(--accent-amber);"><i class="fas fa-chalkboard-teacher"></i>
                </div>
                <span class="stat-value" style="color: var(--accent-amber);">{{ stats['faculty'] }}</span>
                <span class="stat-label">Mentorship Core</span>
            </div>
        </div>
    </div>

    <!-- Deep Scan Section -->
    <div class="row g-4">
        <!-- Population Density -->
        <div class="col-lg-7 fade-up" style="animation-delay: 0.5s;">
            <div class="glass-card h-100">
                <div class="d-flex justify-content-between align-items-center mb-5">
                    <h4 class="fw-800 mb-0"><i class="fas fa-project-diagram me-3 text-primary"></i> Population Density
                        Matrix</h4>
                    <span class="badge bg-primary-subtle text-primary fw-800 px-3">NODE_SCAN</span>
                </div>

                {% set student_pct = (stats['students'] / stats['total_users'] * 100) | int if stats['total_users'] > 0
                else 0 %}
                <div class="density-node">
                    <div class="density-label">
                        <span>LEARNER_SEGMENT</span>
                        <span class="density-target">{{ stats['students'] }} / {{ stats['total_users'] }}</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill progress-dynamic"
                            style="background: var(--accent-primary); width: 0%;" data-progress="{{ student_pct }}">
                        </div>
                    </div>
                </div>

                {% set alumni_pct = (stats['alumni'] / stats['total_users'] * 100) | int if stats['total_users'] > 0
                else 0 %}
                <div class="density-node">
                    <div class="density-label">
                        <span>LEGACY_SEGMENT</span>
                        <span class="density-target">{{ stats['alumni'] }} / {{ stats['total_users'] }}</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill progress-dynamic"
                            style="background: var(--accent-emerald); width: 0%;" data-progress="{{ alumni_pct }}">
                        </div>
                    </div>
                </div>

                {% set faculty_pct = (stats['faculty'] / stats['total_users'] * 100) | int if stats['total_users'] > 0
                else 0 %}
                <div class="density-node">
                    <div class="density-label">
                        <span>ACADEMIC_SEGMENT</span>
                        <span class="density-target">{{ stats['faculty'] }} / {{ stats['total_users'] }}</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill progress-dynamic" style="background: var(--accent-amber); width: 0%;"
                            data-progress="{{ faculty_pct }}"></div>
                    </div>
                </div>

                {% set admin_pct = (stats['admin'] / stats['total_users'] * 100) | int if stats['total_users'] > 0 else
                0 %}
                <div class="density-node mb-0">
                    <div class="density-label">
                        <span>ADMIN_CORE</span>
                        <span class="density-target">{{ stats['admin'] }} / {{ stats['total_users'] }}</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill progress-dynamic" style="background: var(--accent-rose); width: 0%;"
                            data-progress="{{ admin_pct }}"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Operations Console -->
        <div class="col-lg-5 fade-up" style="animation-delay: 0.6s;">
            <div class="glass-card h-100">
                <h4 class="fw-800 mb-4"><i class="fas fa-atom me-3 text-warning"></i> Operations Console</h4>

                <div class="nexus-info">
                    <div class="d-flex gap-3">
                        <i class="fas fa-info-circle text-primary mt-1"></i>
                        <p class="small mb-0 text-dim fw-bold">Real-time edge synchronization active. All segment
                            telemetry is verified against the master registry nodes.</p>
                    </div>
                </div>

                <div class="d-flex flex-column gap-2 mt-4">
                    <h6 class="stat-label mb-3">Segment Inspections</h6>
                    <a href="{{ url_for('admin_view_users', role='student') }}" class="action-btn">
                        <i class="fas fa-user-graduate" style="color: var(--accent-primary);"></i>
                        <span>Inspect Learner Cluster</span>
                        <i class="fas fa-arrow-right ms-auto extra-small opacity-50"></i>
                    </a>
                    <a href="{{ url_for('admin_view_users', role='alumni') }}" class="action-btn">
                        <i class="fas fa-user-tie" style="color: var(--accent-emerald);"></i>
                        <span>Inspect Legacy Cluster</span>
                        <i class="fas fa-arrow-right ms-auto extra-small opacity-50"></i>
                    </a>
                    <a href="{{ url_for('admin_view_users', role='faculty') }}" class="action-btn">
                        <i class="fas fa-chalkboard-teacher" style="color: var(--accent-amber);"></i>
                        <span>Inspect Mentorship Core</span>
                        <i class="fas fa-arrow-right ms-auto extra-small opacity-50"></i>
                    </a>
                    <a href="{{ url_for('admin_messaging_control') }}" class="action-btn">
                        <i class="fas fa-broadcast-tower" style="color: var(--accent-rose);"></i>
                        <span>Omni Alert System</span>
                        <i class="fas fa-arrow-right ms-auto extra-small opacity-50"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 1. Progress Animations
        setTimeout(() => {
            document.querySelectorAll('.progress-dynamic').forEach(fill => {
                const pct = fill.getAttribute('data-progress');
                fill.style.width = pct + '%';
            });
        }, 300);

        // 2. Network Background Animation
        const canvas = document.getElementById('networkCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function initCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            for (let i = 0; i < 60; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.4,
                    vy: (Math.random() - 0.5) * 0.4,
                    size: Math.random() * 2 + 1
                });
            }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'rgba(99, 102, 241, 0.4)';
            ctx.strokeStyle = 'rgba(99, 102, 241, 0.08)';

            particles.forEach((p, index) => {
                p.x += p.vx;
                p.y += p.vy;

                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();

                for (let j = index + 1; j < particles.length; j++) {
                    const p2 = particles[j];
                    const dist = Math.hypot(p.x - p2.x, p.y - p2.y);
                    if (dist < 120) {
                        ctx.beginPath();
                        ctx.lineWidth = 1;
                        ctx.moveTo(p.x, p.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                }
            });
            requestAnimationFrame(animate);
        }

        initCanvas();
        animate();
        window.addEventListener('resize', initCanvas);
    });
</script>
{% endblock %}