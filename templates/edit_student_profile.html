<!-- filepath: d:\RajenderMohan_BCA\RajenderMohan_Projects\6_Semester\Major Project\Alumni App\templates\edit_student_profile.html -->
{% extends "base.html" %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0" style="border-radius: 15px; animation: slideInUp 0.6s ease;">
                <div class="card-header bg-primary text-white" style="border-radius: 15px 15px 0 0;">
                    <h3 class="mb-0"><i class="fas fa-edit"></i> Edit Student Profile</h3>
                    <small>Update your academic and personal information</small>
                </div>
                <div class="card-body p-5">
                    <form id="editForm" method="POST" enctype="multipart/form-data" class="needs-validation">
                        <!-- Profile Photo -->
                        <div class="card mb-4 border-light">
                            <div class="card-header bg-light border-0">
                                <h6 class="mb-0"><i class="fas fa-image"></i> Profile Photo</h6>
                            </div>
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <img id="photoPreview" 
                                         src="https://ui-avatars.com/api/?name={{ user['name'] }}&size=150&background=0D6EFD&color=fff&rounded=true" 
                                         alt="Profile Photo" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
                                </div>
                                <div class="mb-3">
                                    <label for="profile_pic" class="form-label">Upload Photo (JPG, PNG, GIF - Max 16MB)</label>
                                    <input type="file" class="form-control" id="profile_pic" name="profile_pic" 
                                           accept="image/*" onchange="previewPhoto(this)">
                                    <small class="text-muted">Click to upload or change your profile picture</small>
                                </div>
                            </div>
                        </div>

                        <!-- Personal Information -->
                        <div class="card mb-4 border-light">
                            <div class="card-header bg-light border-0">
                                <h6 class="mb-0"><i class="fas fa-user-circle"></i> Personal Information</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="name" class="form-label">Full Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="name" name="name" 
                                               value="{{ user['name'] }}" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="phone" class="form-label">Phone <span class="text-danger">*</span></label>
                                        <input type="tel" class="form-control" id="phone" name="phone" 
                                               value="{{ user['phone'] or '' }}" required>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email (Cannot be changed)</label>
                                    <input type="email" class="form-control" value="{{ user['email'] }}" disabled>
                                </div>
                            </div>
                        </div>

                        <!-- Academic Information -->
                        <div class="card mb-4 border-light">
                            <div class="card-header bg-light border-0">
                                <h6 class="mb-0"><i class="fas fa-book"></i> Academic Information</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Enrollment No. (Fixed)</label>
                                        <input type="text" class="form-control" value="{{ profile['enrollment_no'] }}" disabled>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Department (Fixed)</label>
                                        <input type="text" class="form-control" value="{{ profile['department'] }}" disabled>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Degree (Fixed)</label>
                                        <input type="text" class="form-control" value="{{ profile['degree'] }}" disabled>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="semester" class="form-label">Current Semester</label>
                                        <select class="form-select" id="semester" name="semester">
                                            <option value="">Select Semester</option>
                                            {% for i in range(1, 7) %}
                                            <option value="{{ i }}" {% if profile['semester'] == i %}selected{% endif %}>{{ i }}{{ 'st' if i == 1 else 'nd' if i == 2 else 'rd' if i == 3 else 'th' }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="cgpa" class="form-label">CGPA</label>
                                        <input type="number" class="form-control" id="cgpa" name="cgpa" 
                                               step="0.01" min="0" max="10" value="{{ profile['cgpa'] or '' }}" 
                                               placeholder="e.g., 3.8">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Skills & Achievements -->
                        <div class="card mb-4 border-light">
                            <div class="card-header bg-light border-0">
                                <h6 class="mb-0"><i class="fas fa-star"></i> Skills & Achievements</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="skills" class="form-label">Skills 
                                        <small class="text-muted">(comma-separated)</small>
                                    </label>
                                    <textarea class="form-control" id="skills" name="skills" rows="2" 
                                              placeholder="e.g., Python, JavaScript, Web Development, Problem Solving">{{ profile['skills'] or '' }}</textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="achievements" class="form-label">Achievements 
                                        <small class="text-muted">(use | to separate)</small>
                                    </label>
                                    <textarea class="form-control" id="achievements" name="achievements" rows="3" 
                                              placeholder="e.g., 1st Prize in Hackathon | Published research paper | Dean's List">{{ profile['achievements'] or '' }}</textarea>
                                </div>

                                <div class="mb-3">
                                    <label for="resume_link" class="form-label">Resume Link</label>
                                    <input type="url" class="form-control" id="resume_link" name="resume_link" 
                                           value="{{ profile['resume_link'] or '' }}" 
                                           placeholder="https://drive.google.com/... or your portfolio link">
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg fw-bold">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                            <a href="{{ url_for('student_profile', user_id=user['id']) }}" class="btn btn-outline-secondary">
                                Cancel & Go Back
                            </a>
                            <a href="{{ url_for('change_password') }}" class="btn btn-outline-info">
                                <i class="fas fa-lock"></i> Change Password
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border-radius: 10px;
        transition: all 0.3s ease;
        border: none !important;
    }

    .card-header {
        border-radius: 10px 10px 0 0 !important;
    }

    @keyframes slideInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    #photoPreview {
        transition: all 0.3s ease;
        border: 3px solid #0D6EFD;
        animation: pulse 2s infinite;
    }

    #photoPreview:hover {
        box-shadow: 0 0 20px rgba(13, 110, 253, 0.5);
    }
</style>

<script>
function previewPhoto(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('photoPreview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Toast notification function
function showToast(message, type = 'warning') {
    const toastHtml = `
        <div class="toast align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true" style="position: fixed; top: 20px; right: 20px; z-index: 9999; min-width: 300px;">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-${type === 'warning' ? 'exclamation-circle' : 'check-circle'} me-2"></i>${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    `;
    const toastContainer = document.createElement('div');
    toastContainer.innerHTML = toastHtml;
    document.body.appendChild(toastContainer);
    
    const toastElement = toastContainer.querySelector('.toast');
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
    
    setTimeout(() => toastContainer.remove(), 5000);
}

// Form submission with validation
document.getElementById('editForm').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();
    
    if (!name) {
        e.preventDefault();
        showToast('Name is required!', 'warning');
        return false;
    }
    
    if (!phone) {
        e.preventDefault();
        showToast('Phone is required!', 'warning');
        return false;
    }
    
    // If validation passes, form submits normally
    return true;
});
</script>
{% endblock %}