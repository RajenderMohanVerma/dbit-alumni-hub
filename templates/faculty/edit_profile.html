{% extends "base.html" %}

{% block content %}
<!-- Advanced Animation & Utility Libraries -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

<div class="profile-redesign-wrapper">
    <!-- Interactive Background Layer -->
    <div id="particles-js" class="particles-bg"></div>
    <div class="glass-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <div class="container py-5 position-relative" style="z-index: 10;">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Header -->
                <div class="text-center mb-5" data-aos="fade-down">
                    <span class="badge glass-pill-primary px-3 py-2 mb-3">
                        <i class="fas fa-cog me-2"></i> PROFILE MANAGEMENT
                    </span>
                    <h1 class="text-white fw-bold display-5">Update Your <span class="text-warning">Expertise</span>
                    </h1>
                    <p class="text-white-50">Refine your professional credentials and office accessibility</p>
                </div>

                <form id="editForm" method="POST" enctype="multipart/form-data" class="needs-validation">
                    <div class="glass-card-form mb-5" data-aos="fade-up" data-aos-delay="100">
                        <!-- Photo Section -->
                        <div class="text-center mb-5 section-reveal position-relative">
                            <div class="avatar-edit-container mb-4">
                                <div class="avatar-glow"></div>
                                <img id="photoPreview"
                                    src="{{ user['profile_pic'] if user['profile_pic'] and user['profile_pic'].startswith('/') else 'https://ui-avatars.com/api/?name=' + user['name'] + '&size=200&background=0D6EFD&color=fff' }}"
                                    alt="Profile Photo" class="avatar-img shadow-2xl">
                                <label for="profile_pic" class="avatar-upload-btn">
                                    <i class="fas fa-camera"></i>
                                </label>
                            </div>
                            <input type="file" id="profile_pic" name="profile_pic" class="d-none" accept="image/*"
                                onchange="previewPhoto(this)">
                            <h4 class="fw-bold text-white mb-1">{{ user['name'] }}</h4>
                            <p class="text-white-50 small">{{ profile['designation'] }} â€¢ {{ profile['department'] }}
                            </p>
                        </div>

                        <!-- Registry Information -->
                        <div class="premium-form-section mb-5">
                            <h5 class="section-title text-white mb-4">
                                <i class="fas fa-id-card text-primary me-2"></i> Registry Information
                            </h5>
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-group-glass">
                                        <label for="name" class="form-label-glass">Legal Name</label>
                                        <input type="text" class="form-control" id="name" name="name"
                                            value="{{ user['name'] }}" required placeholder="e.g. Dr. John Doe">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-glass">
                                        <label for="phone" class="form-label-glass">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone" name="phone"
                                            value="{{ user['phone'] or '' }}" required
                                            placeholder="e.g. +91 98765 43210">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-glass disabled">
                                        <label class="form-label-glass">Academic Department</label>
                                        <div class="input-with-icon">
                                            <input type="text" class="form-control" value="{{ profile['department'] }}"
                                                disabled>
                                            <i class="fas fa-lock lock-icon"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-glass disabled">
                                        <label class="form-label-glass">Designation</label>
                                        <div class="input-with-icon">
                                            <input type="text" class="form-control" value="{{ profile['designation'] }}"
                                                disabled>
                                            <i class="fas fa-lock lock-icon"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Expertise -->
                        <div class="premium-form-section mb-5">
                            <h5 class="section-title text-white mb-4">
                                <i class="fas fa-award text-warning me-2"></i> Expertise & Experience
                            </h5>
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <div class="form-group-glass">
                                        <label for="experience_years" class="form-label-glass">Years of
                                            Experience</label>
                                        <input type="number" class="form-control" id="experience_years"
                                            name="experience_years" value="{{ profile['experience_years'] or '' }}"
                                            min="0" placeholder="e.g. 10">
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="form-group-glass">
                                        <label class="form-label-glass">Specializations (Type & Press Enter)</label>
                                        <div class="tag-input-glass" id="tagInputContainer">
                                            <!-- Tags will be injected here -->
                                            <input type="text" id="tagInput" class="tag-input-field"
                                                placeholder="e.g. Machine Learning, Cloud Computing...">
                                        </div>
                                    </div>
                                    <input type="hidden" name="specialization" id="specializationHidden"
                                        value="{{ profile['specialization'] or '' }}">
                                </div>
                            </div>
                        </div>

                        <!-- Accessibility -->
                        <div class="premium-form-section mb-5">
                            <h5 class="section-title text-white mb-4">
                                <i class="fas fa-door-open text-success me-2"></i> Accessibility
                            </h5>
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-group-glass">
                                        <label for="office_location" class="form-label-glass">Office Location / Room
                                            No.</label>
                                        <input type="text" class="form-control" id="office_location"
                                            name="office_location" value="{{ profile['office_location'] or '' }}"
                                            placeholder="e.g. Block A, Room 302">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-glass">
                                        <label for="office_hours" class="form-label-glass">Office Availability
                                            Hours</label>
                                        <input type="text" class="form-control" id="office_hours" name="office_hours"
                                            value="{{ profile['office_hours'] or '' }}"
                                            placeholder="e.g. Mon-Fri, 2PM - 4PM">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bio -->
                        <div class="premium-form-section mb-5">
                            <h5 class="section-title text-white mb-4">
                                <i class="fas fa-feather-alt text-info me-2"></i> Professional Philosophy
                            </h5>
                            <div class="form-group-glass">
                                <label for="bio" class="form-label-glass">Teaching Philosophy / Biography</label>
                                <textarea class="form-control" id="bio" name="bio" style="height: 150px"
                                    placeholder="Share your academic background and teaching approach...">{{ profile['bio'] or '' }}</textarea>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="d-flex flex-column flex-md-row gap-3 pt-4">
                            <button type="submit" class="btn btn-premium-gradient flex-grow-1 py-3">
                                <i class="fas fa-save me-2"></i> Save Changes
                            </button>
                            <a href="{{ url_for('faculty_profile', user_id=current_user.id) }}"
                                class="btn btn-glass-outline py-3">
                                Cancel
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --glass-bg: rgba(255, 255, 255, 0.03);
        --glass-border: rgba(255, 255, 255, 0.1);
        --accent-primary: #6366f1;
        --accent-warning: #f59e0b;
    }

    .profile-redesign-wrapper {
        position: relative;
        background: #060a16;
        min-height: 100vh;
        overflow-x: hidden;
        padding-top: 100px;
        font-family: 'Plus Jakarta Sans', sans-serif;
    }

    /* Backgrounds */
    .particles-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        opacity: 0.4;
    }

    .glass-orbs {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 2;
        pointer-events: none;
    }

    .orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(100px);
        opacity: 0.15;
    }

    .orb-1 {
        top: 10%;
        left: 10%;
        width: 400px;
        height: 400px;
        background: var(--accent-primary);
        animation: floatOrb 20s infinite ease-in-out;
    }

    .orb-2 {
        bottom: 20%;
        right: 10%;
        width: 300px;
        height: 300px;
        background: var(--accent-warning);
        animation: floatOrb 25s infinite ease-in-out reverse;
    }

    .glass-card-form {
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 30px;
        padding: 40px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    /* Forms */
    .form-group-glass {
        margin-bottom: 0;
        position: relative;
    }

    .form-label-glass {
        display: block;
        color: white;
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 10px;
        margin-left: 5px;
        letter-spacing: 0.5px;
        opacity: 0.9;
    }

    .form-group-glass .form-control {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--glass-border);
        color: white;
        border-radius: 12px;
        height: auto;
        padding: 12px 18px;
        transition: 0.3s;
    }

    .form-group-glass .form-control::placeholder {
        color: rgba(255, 255, 255, 0.3);
        font-weight: 400;
    }

    .form-group-glass .form-control:focus {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        outline: none;
    }

    .form-group-glass.disabled .form-control {
        background: rgba(255, 255, 255, 0.01);
        color: rgba(255, 255, 255, 0.3);
        border-style: dashed;
        cursor: not-allowed;
    }

    .input-with-icon {
        position: relative;
    }

    .lock-icon {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: rgba(255, 255, 255, 0.2);
    }

    /* Tags */
    .tag-input-glass {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid var(--glass-border);
        border-radius: 12px;
        padding: 8px 12px;
        min-height: 52px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        transition: 0.3s;
    }

    .tag-input-glass:focus-within {
        border-color: var(--accent-warning);
        box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
    }

    .tag-input-field {
        background: transparent;
        border: none;
        color: white;
        outline: none;
        flex: 1;
        min-width: 150px;
    }

    .tag-input-field::placeholder {
        color: rgba(255, 255, 255, 0.3);
    }

    .glass-tag {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        padding: 4px 12px;
        border-radius: 8px;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-tag i {
        cursor: pointer;
        opacity: 0.7;
    }

    .glass-tag i:hover {
        opacity: 1;
        color: #ef4444;
    }

    /* Avatar */
    .avatar-edit-container {
        position: relative;
        width: 160px;
        height: 160px;
        margin: 0 auto;
    }

    .avatar-img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid rgba(255, 255, 255, 0.1);
    }

    .avatar-upload-btn {
        position: absolute;
        bottom: 5px;
        right: 5px;
        width: 45px;
        height: 45px;
        background: var(--accent-primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        cursor: pointer;
        transition: 0.3s;
        border: 3px solid #060a16;
    }

    .avatar-upload-btn:hover {
        background: white;
        color: var(--accent-primary);
        transform: scale(1.1);
    }

    /* Buttons */
    .btn-premium-gradient {
        background: linear-gradient(135deg, var(--accent-primary) 0%, #8b5cf6 100%);
        color: white;
        border: none;
        border-radius: 15px;
        font-weight: 700;
        transition: 0.3s;
    }

    .btn-premium-gradient:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        color: white;
    }

    .btn-glass-outline {
        border: 1px solid var(--glass-border);
        color: white;
        border-radius: 15px;
        padding: 0 30px;
        display: flex;
        align-items: center;
        font-weight: 600;
        transition: 0.3s;
    }

    .btn-glass-outline:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }

    .glass-pill-primary {
        background: rgba(99, 102, 241, 0.1);
        color: #818cf8;
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 50px;
    }

    @keyframes floatOrb {

        0%,
        100% {
            transform: translate(0, 0);
        }

        50% {
            transform: translate(30px, -30px);
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Init Animation
        if (typeof AOS !== 'undefined') AOS.init({ duration: 800, once: true });

        // Init Particles
        if (typeof particlesJS !== 'undefined') {
            particlesJS('particles-js', {
                "particles": {
                    "number": { "value": 60, "density": { "enable": true, "value_area": 800 } },
                    "color": { "value": "#ffffff" },
                    "shape": { "type": "circle" },
                    "opacity": { "value": 0.3, "random": true },
                    "size": { "value": 3, "random": true },
                    "line_linked": { "enable": true, "distance": 150, "color": "#ffffff", "opacity": 0.1, "width": 1 },
                    "move": { "enable": true, "speed": 1 }
                },
                "interactivity": {
                    "events": { "onhover": { "enable": true, "mode": "grab" } }
                },
                "retina_detect": true
            });
        }

        // Tag Input Logic
        const container = document.getElementById('tagInputContainer');
        const input = document.getElementById('tagInput');
        const hidden = document.getElementById('specializationHidden');
        let tags = hidden.value ? hidden.value.split(',').map(s => s.trim()).filter(s => s) : [];

        function render() {
            container.querySelectorAll('.glass-tag').forEach(t => t.remove());
            tags.forEach((tag, idx) => {
                const el = document.createElement('span');
                el.className = 'glass-tag';
                el.innerHTML = `${tag} <i class="fas fa-times" onclick="removeTag(${idx})"></i>`;
                container.insertBefore(el, input);
            });
            hidden.value = tags.join(',');
        }

        input.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ',') {
                e.preventDefault();
                const val = input.value.trim().replace(/,/g, '');
                if (val && !tags.includes(val)) {
                    tags.push(val);
                    render();
                    input.value = '';
                }
            } else if (e.key === 'Backspace' && !input.value) {
                tags.pop();
                render();
            }
        });

        window.removeTag = idx => { tags.splice(idx, 1); render(); };
        container.addEventListener('click', () => input.focus());
        render();
    });

    function previewPhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => { document.getElementById('photoPreview').src = e.target.result; };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}