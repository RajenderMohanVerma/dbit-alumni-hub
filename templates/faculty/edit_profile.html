{% extends "base.html" %}

{% block content %}
<!-- Premium Fonts -->
<link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

<div class="profile-wrapper">
    <!-- Animated Mesh Background -->
    <div class="mesh-background">
        <div class="mesh-ball ball-amber-1"></div>
        <div class="mesh-ball ball-amber-2"></div>
        <div class="mesh-ball ball-amber-3"></div>
        <div class="mesh-ball ball-amber-4"></div>
    </div>

    <!-- Header Section -->
    <div class="profile-hero glass-hero hero-amber">
        <div class="hero-particles"></div>
        <div class="hero-glow-point"></div>
        <div class="container" style="position: relative; z-index: 2;">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="hero-content">
                        <div class="badge rounded-pill bg-white text-warning px-3 py-2 mb-3 shadow-sm reveal-fade"
                            style="font-weight: 700; letter-spacing: 0.5px;">
                            <i class="fas fa-university me-2"></i> ACADEMIC IDENTITY
                        </div>
                        <h1 class="text-white display-4 fw-bold mb-3 reveal-text">
                            Faculty <span class="text-holographic">Management</span>
                        </h1>
                        <p class="text-white-50 lead mb-0 reveal-fade" style="font-size: 1.25rem;">
                            Refine your professional credentials and office accessibility.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-n5 mb-5" style="position: relative; z-index: 5; margin-top: -60px;">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <form id="editForm" method="POST" enctype="multipart/form-data" class="needs-validation">
                    <div class="card border-0 glass-card holographic-border mb-5 reveal-fade">
                        <div class="card-body p-4 p-md-5">

                            <!-- Photo Section -->
                            <div class="text-center mb-5 section-reveal">
                                <div class="avatar-edit-container mb-4">
                                    <img id="photoPreview"
                                        src="{{ user['profile_pic'] if user['profile_pic'] and user['profile_pic'].startswith('/') else 'https://ui-avatars.com/api/?name=' + user['name'] + '&size=200&background=f59e0b&color=fff' }}"
                                        alt="Profile Photo" class="avatar-img shadow-lg">
                                    <label for="profile_pic" class="avatar-upload-badge shadow-lg badge-amber">
                                        <i class="fas fa-camera"></i>
                                    </label>
                                </div>
                                <input type="file" id="profile_pic" name="profile_pic" class="d-none" accept="image/*"
                                    onchange="previewPhoto(this)">
                                <h4 class="fw-bold text-dark mb-1">{{ user['name'] }}</h4>
                                <p class="text-muted small">{{ profile['designation'] }} â€¢ {{ profile['department'] }}
                                </p>
                            </div>

                            <!-- Essential Details -->
                            <div class="premium-form-section mb-5">
                                <h5 class="section-title mb-4 reveal-text">
                                    <span class="title-icon icon-amber"><i class="fas fa-id-card"></i></span>
                                    Registry Information
                                </h5>
                                <div class="row g-4">
                                    <div class="col-md-6 reveal-fade">
                                        <div class="form-floating-premium">
                                            <input type="text" class="form-control" id="name" name="name"
                                                value="{{ user['name'] }}" required placeholder="Full Name">
                                            <label for="name">Legal Name</label>
                                            <div class="focus-border"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 reveal-fade">
                                        <div class="form-floating-premium">
                                            <input type="tel" class="form-control" id="phone" name="phone"
                                                value="{{ user['phone'] or '' }}" required placeholder="Phone">
                                            <label for="phone">Phone Number</label>
                                            <div class="focus-border"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 reveal-fade">
                                        <div class="form-floating-premium">
                                            <input type="text" class="form-control disabled-input"
                                                value="{{ profile['department'] }}" disabled>
                                            <label>Academic Department</label>
                                            <i class="fas fa-lock input-locked-icon"></i>
                                        </div>
                                    </div>
                                    <div class="col-md-6 reveal-fade">
                                        <div class="form-floating-premium">
                                            <input type="text" class="form-control disabled-input"
                                                value="{{ profile['designation'] }}" disabled>
                                            <label>Designation</label>
                                            <i class="fas fa-lock input-locked-icon"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Professional Credentials -->
                            <div class="premium-form-section mb-5">
                                <h5 class="section-title mb-4 reveal-text">
                                    <span class="title-icon icon-blue"><i class="fas fa-award"></i></span>
                                    Expertise & Experience
                                </h5>
                                <div class="row g-4">
                                    <div class="col-md-4 reveal-fade">
                                        <div class="form-floating-premium">
                                            <input type="number" class="form-control" id="experience_years"
                                                name="experience_years" value="{{ profile['experience_years'] or '' }}"
                                                min="0" placeholder="Years">
                                            <label for="experience_years">Experience (Years)</label>
                                            <div class="focus-border"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-8 reveal-fade">
                                        <label class="text-muted small mb-2 fw-bold ms-1">Specializations (Press Enter
                                            to add)</label>
                                        <div class="tag-input-container form-control-premium" id="tagInputContainer">
                                            <!-- Tags will be injected here -->
                                            <input type="text" id="tagInput" class="tag-input-field"
                                                placeholder="Add specialty...">
                                        </div>
                                        <input type="hidden" name="specialization" id="specializationHidden"
                                            value="{{ profile['specialization'] or '' }}">
                                    </div>
                                </div>
                            </div>

                            <!-- Office Section -->
                            <div class="premium-form-section mb-5">
                                <h5 class="section-title mb-4 reveal-text">
                                    <span class="title-icon icon-green"><i class="fas fa-door-open"></i></span>
                                    Accessibility Details
                                </h5>
                                <div class="row g-4">
                                    <div class="col-md-6 reveal-fade">
                                        <div class="form-floating-premium">
                                            <input type="text" class="form-control" id="office_location"
                                                name="office_location" value="{{ profile['office_location'] or '' }}"
                                                placeholder="Office">
                                            <label for="office_location">Office Location / Room No.</label>
                                            <div class="focus-border"></div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 reveal-fade">
                                        <div class="form-floating-premium">
                                            <input type="text" class="form-control" id="office_hours"
                                                name="office_hours" value="{{ profile['office_hours'] or '' }}"
                                                placeholder="Hours">
                                            <label for="office_hours">Office Availability Hours</label>
                                            <div class="focus-border"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bio Section -->
                            <div class="premium-form-section mb-5">
                                <h5 class="section-title mb-4 reveal-text">
                                    <span class="title-icon icon-purple"><i class="fas fa-book-reader"></i></span>
                                    Professional Philosophy
                                </h5>
                                <div class="row g-4">
                                    <div class="col-12 reveal-fade">
                                        <div class="form-floating-premium">
                                            <textarea class="form-control" id="bio" name="bio" style="height: 150px"
                                                placeholder="Bio">{{ profile['bio'] or '' }}</textarea>
                                            <label for="bio">Teaching Philosophy / Biography</label>
                                            <div class="focus-border"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="d-flex flex-column flex-md-row gap-3 pt-4 reveal-fade">
                                <button type="submit" class="btn btn-amber-gradient flex-grow-1">
                                    <i class="fas fa-save me-2"></i> Commit Updates
                                </button>
                                <a href="{{ url_for('faculty_profile', user_id=user['id']) }}"
                                    class="btn btn-glass-outline">
                                    Discard Changes
                                </a>
                                <a href="{{ url_for('change_password') }}" class="btn btn-glass-info">
                                    <i class="fas fa-key me-2"></i> Security Portal
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    /* Global Styles & Mesh */
    body {
        font-family: 'Outfit', sans-serif;
        background-color: #fffbeb;
        overflow-x: hidden;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        font-family: 'Plus Jakarta Sans', sans-serif;
    }

    .profile-wrapper {
        position: relative;
        overflow: hidden;
        min-height: 100vh;
    }

    .mesh-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
        background: #fffbeb;
        pointer-events: none;
    }

    .mesh-ball {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.18;
        animation: mesh-float 25s infinite alternate ease-in-out;
    }

    .ball-amber-1 {
        width: 600px;
        height: 600px;
        background: #f59e0b;
        top: -10%;
        left: -10%;
    }

    .ball-amber-2 {
        width: 500px;
        height: 500px;
        background: #fbbf24;
        bottom: 10%;
        right: -5%;
    }

    .ball-amber-3 {
        width: 400px;
        height: 400px;
        background: #ea580c;
        top: 40%;
        left: 30%;
    }

    .ball-amber-4 {
        width: 450px;
        height: 450px;
        background: #fcd34d;
        top: 10%;
        right: 20%;
    }

    @keyframes mesh-float {
        0% {
            transform: translate(0, 0) scale(1);
        }

        100% {
            transform: translate(150px, 100px) scale(1.1);
        }
    }

    /* Hero Section */
    .profile-hero {
        padding: 120px 0 100px;
        background: linear-gradient(135deg, #78350f 0%, #92400e 100%);
        position: relative;
        overflow: hidden;
    }

    .text-holographic {
        background: linear-gradient(90deg, #fbbf24, #f59e0b, #fb923c, #fbbf24);
        background-size: 300% 100%;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: holographic-move 8s linear infinite;
    }

    @keyframes holographic-move {
        0% {
            background-position: 0% 50%;
        }

        100% {
            background-position: 300% 50%;
        }
    }

    /* Glass Cards */
    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.6) !important;
        border-radius: 40px !important;
        box-shadow: 0 40px 80px rgba(120, 53, 15, 0.08) !important;
    }

    .holographic-border {
        position: relative;
    }

    .holographic-border::after {
        content: '';
        position: absolute;
        inset: -2px;
        z-index: -1;
        background: linear-gradient(90deg, #f59e0b, #fbbf24, #fcd34d, #f59e0b);
        background-size: 300% 100%;
        border-radius: 42px;
        opacity: 0.25;
        animation: holographic-move 8s linear infinite;
    }

    /* Photo Edit */
    .avatar-edit-container {
        position: relative;
        width: 160px;
        height: 160px;
        margin: 0 auto;
    }

    .avatar-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
        border: 4px solid #fff;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    .avatar-upload-badge {
        position: absolute;
        bottom: 8px;
        right: 8px;
        width: 44px;
        height: 44px;
        background: #f59e0b;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .avatar-upload-badge:hover {
        transform: scale(1.1) rotate(10deg);
        background: #92400e;
    }

    /* Form Inputs */
    .premium-form-section .section-title {
        font-size: 1.15rem;
        font-weight: 800;
        color: #451a03;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .title-icon {
        width: 38px;
        height: 38px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .icon-amber {
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
    }

    .icon-blue {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
    }

    .icon-green {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
    }

    .icon-purple {
        background: rgba(168, 85, 247, 0.1);
        color: #a855f7;
    }

    .form-floating-premium {
        position: relative;
    }

    .form-floating-premium .form-control,
    .form-floating-premium .form-select {
        height: 62px;
        padding: 1.6rem 1rem 0.4rem;
        border: 1px solid #fef3c7;
        border-radius: 18px;
        font-weight: 600;
        color: #451a03;
        background: #fff;
        transition: all 0.3s ease;
    }

    .form-floating-premium .form-control:focus {
        border-color: #f59e0b;
        box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
        outline: none;
    }

    .form-floating-premium label {
        position: absolute;
        top: 0;
        left: 0;
        padding: 1rem;
        font-size: 0.85rem;
        font-weight: 700;
        color: #d97706;
        pointer-events: none;
        transition: 0.3s ease;
        opacity: 0.6;
    }

    .form-floating-premium .form-control:focus~label,
    .form-floating-premium .form-control:not(:placeholder-shown)~label {
        transform: translateY(-8px) scale(0.8);
        color: #f59e0b;
        opacity: 1;
    }

    .disabled-input {
        background: #fffbeb !important;
        cursor: not-allowed;
        color: #92400e !important;
    }

    .input-locked-icon {
        position: absolute;
        top: 50%;
        right: 15px;
        transform: translateY(-50%);
        color: #f59e0b;
        opacity: 0.5;
    }

    /* Tag Input Styles */
    .tag-input-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 12px;
        min-height: 62px;
        border: 1px solid #fef3c7;
        border-radius: 18px;
        background: white;
        transition: all 0.3s;
    }

    .tag-input-container:focus-within {
        border-color: #f59e0b;
        box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
    }

    .tag {
        background: rgba(245, 158, 11, 0.15);
        color: #92400e;
        font-weight: 700;
        padding: 6px 14px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        animation: pop-in 0.3s ease;
    }

    .tag i {
        cursor: pointer;
        opacity: 0.6;
        transition: 0.2s;
    }

    .tag i:hover {
        opacity: 1;
        transform: scale(1.2);
    }

    .tag-input-field {
        border: none;
        outline: none;
        flex: 1;
        min-width: 120px;
        font-weight: 600;
        color: #451a03;
    }

    /* Buttons */
    .btn-amber-gradient {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        padding: 14px 28px;
        border-radius: 18px;
        font-weight: 700;
        border: none;
        transition: 0.3s;
        box-shadow: 0 10px 20px rgba(245, 158, 11, 0.2);
    }

    .btn-amber-gradient:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px rgba(245, 158, 11, 0.3);
        color: white;
    }

    .btn-glass-outline {
        padding: 14px 28px;
        border-radius: 18px;
        border: 1px solid #fef3c7;
        font-weight: 700;
        transition: 0.3s;
        color: #92400e;
    }

    /* Reveal */
    .reveal-text {
        opacity: 0;
        transform: translateY(20px);
        transition: all 1s ease;
    }

    .reveal-fade {
        opacity: 0;
        transform: scale(0.98);
        transition: all 1s ease;
    }

    .revealed {
        opacity: 1 !important;
        transform: translate(0, 0) scale(1) !important;
    }

    @keyframes pop-in {
        from {
            transform: scale(0.8);
            opacity: 0;
        }

        to {
            transform: scale(1);
            opacity: 1;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Tag Input Logic
        const container = document.getElementById('tagInputContainer');
        const input = document.getElementById('tagInput');
        const hidden = document.getElementById('specializationHidden');
        let tags = hidden.value ? hidden.value.split(',').map(s => s.trim()).filter(s => s) : [];

        function render() {
            container.querySelectorAll('.tag').forEach(t => t.remove());
            tags.forEach((tag, idx) => {
                const el = document.createElement('span');
                el.className = 'tag';
                el.innerHTML = `${tag} <i class="fas fa-times" onclick="removeTag(${idx})"></i>`;
                container.insertBefore(el, input);
            });
            hidden.value = tags.join(',');
        }

        input.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ',') {
                e.preventDefault();
                const val = input.value.trim().replace(/,/g, '');
                if (val && !tags.includes(val)) {
                    tags.push(val);
                    render();
                    input.value = '';
                }
            } else if (e.key === 'Backspace' && !input.value) {
                tags.pop();
                render();
            }
        });

        window.removeTag = idx => { tags.splice(idx, 1); render(); };
        container.addEventListener('click', () => input.focus());
        render();

        // Reveal Animations
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('revealed'); });
        });
        document.querySelectorAll('.reveal-text, .reveal-fade').forEach(el => observer.observe(el));
    });

    function previewPhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => { document.getElementById('photoPreview').src = e.target.result; };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}