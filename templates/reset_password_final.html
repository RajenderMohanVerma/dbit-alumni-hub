{% extends 'base.html' %}

{% block title %}Reset Password - DBIT Alumni Hub{% endblock %}

{% block content %}
<!-- Preload fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

<style>
    :root {
        --accent-indigo: #4f46e5;
        --accent-violet: #7c3aed;
        --accent-pink: #ec4899;
        --glass-bg: rgba(255, 255, 255, 0.7);
        --glass-border: rgba(255, 255, 255, 0.4);
    }

    .reset-page-wrapper {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        background: #f8fafc;
        overflow: hidden;
        padding: 2rem;
    }

    /* Animated Orbs */
    .bg-animation {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 0;
    }

    .orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(100px);
        opacity: 0.15;
        animation: floatOrb 20s infinite alternate ease-in-out;
    }

    .orb-1 {
        width: 500px;
        height: 500px;
        background: var(--accent-indigo);
        top: -150px;
        left: -100px;
    }

    .orb-2 {
        width: 450px;
        height: 450px;
        background: var(--accent-violet);
        bottom: -100px;
        right: -50px;
        animation-delay: -5s;
    }

    .orb-3 {
        width: 300px;
        height: 300px;
        background: var(--accent-pink);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0.1;
    }

    @keyframes floatOrb {
        0% {
            transform: translate(0, 0) scale(1);
        }

        100% {
            transform: translate(80px, 40px) scale(1.1);
        }
    }

    /* Glass Card */
    .reset-card {
        background: var(--glass-bg);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        border: 1px solid var(--glass-border);
        border-radius: 40px;
        padding: 4rem;
        width: 100%;
        max-width: 520px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08);
        position: relative;
        z-index: 10;
        animation: cardAppear 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        opacity: 0;
        transform: translateY(30px);
    }

    @keyframes cardAppear {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .icon-area {
        width: 80px;
        height: 80px;
        background: white;
        border-radius: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.04);
        position: relative;
    }

    .icon-box {
        width: 52px;
        height: 52px;
        background: linear-gradient(135deg, var(--accent-indigo), var(--accent-violet));
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        transform: rotate(-10deg);
        transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .reset-card:hover .icon-box {
        transform: rotate(0deg) scale(1.1);
    }

    .reset-title {
        font-family: 'Plus Jakarta Sans', sans-serif;
        font-weight: 800;
        font-size: 2rem;
        color: #1e293b;
        letter-spacing: -1px;
        margin-bottom: 0.5rem;
        text-align: center;
    }

    .text-holographic {
        background: linear-gradient(135deg, #4f46e5, #7c3aed, #ec4899);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        background-size: 200% auto;
        animation: textFlow 3s linear infinite;
    }

    @keyframes textFlow {
        to {
            background-position: 200% center;
        }
    }

    .reset-subtitle {
        color: #64748b;
        font-size: 1rem;
        margin-bottom: 3rem;
        text-align: center;
    }

    /* Form Design */
    .input-group-premium {
        position: relative;
        margin-bottom: 2rem;
    }

    .form-control-premium {
        background: rgba(255, 255, 255, 0.8) !important;
        border: 2px solid #e2e8f0 !important;
        border-radius: 20px !important;
        padding: 1.25rem 3.5rem 1.25rem 3.5rem !important;
        font-size: 1.05rem !important;
        font-weight: 500 !important;
        transition: 0.3s !important;
        color: #1e293b !important;
    }

    .form-control-premium:focus {
        border-color: var(--accent-indigo) !important;
        box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1) !important;
        background: white !important;
    }

    .input-icon {
        position: absolute;
        left: 1.4rem;
        top: 50%;
        transform: translateY(-50%);
        color: #94a3b8;
        font-size: 1.1rem;
        transition: 0.3s;
        z-index: 5;
    }

    .password-toggle {
        position: absolute;
        right: 1.4rem;
        top: 50%;
        transform: translateY(-50%);
        color: #94a3b8;
        cursor: pointer;
        z-index: 10;
        transition: 0.3s;
    }

    .password-toggle:hover {
        color: var(--accent-indigo);
    }

    .form-control-premium:focus~.input-icon {
        color: var(--accent-indigo);
    }

    /* Strength Meter */
    .strength-meter {
        height: 6px;
        background: #e2e8f0;
        border-radius: 10px;
        margin-top: -1.5rem;
        margin-bottom: 2rem;
        overflow: hidden;
        transition: 0.4s;
        opacity: 0;
    }

    .strength-meter.active {
        opacity: 1;
    }

    .strength-bar {
        height: 100%;
        width: 0;
        transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        background: #ef4444;
    }

    /* Premium Button */
    .btn-submit-premium {
        background: linear-gradient(135deg, var(--accent-indigo), var(--accent-violet));
        color: white;
        border: none;
        padding: 1.25rem;
        border-radius: 20px;
        font-weight: 700;
        font-size: 1.1rem;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        box-shadow: 0 15px 30px -10px rgba(79, 70, 229, 0.4);
        transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .btn-submit-premium:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px -10px rgba(79, 70, 229, 0.5);
    }

    .btn-submit-premium::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transform: rotate(45deg);
        transition: 0.5s;
    }

    .btn-submit-premium:hover::after {
        left: 100%;
    }

    /* Custom Alert */
    .alert-modern {
        border-radius: 20px;
        padding: 1.25rem;
        border: none;
        background: rgba(220, 252, 231, 0.9);
        color: #166534;
        font-weight: 600;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 12px;
        backdrop-filter: blur(10px);
    }

    .alert-warning {
        background: rgba(255, 243, 205, 0.9);
        color: #856404;
    }

    /* Success Checkmark Animation */
    @keyframes checkmark {
        0% {
            transform: scale(0);
            opacity: 0;
        }

        50% {
            transform: scale(1.2);
        }

        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
</style>

<div class="reset-page-wrapper">
    <!-- Animated Background -->
    <div class="bg-animation">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <div class="reset-card">
        <!-- Header -->
        <div class="icon-area">
            <div class="icon-box">
                <i class="fas fa-shield-alt"></i>
            </div>
        </div>

        <h1 class="reset-title">Secure <span class="text-holographic">Account</span></h1>
        <p class="reset-subtitle">Create a new, strong password to safeguard your profile.</p>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div
            class="alert alert-modern alert-{{ 'success' if category == 'success' else 'warning' }} animate__animated animate__fadeIn">
            <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-circle' }}"></i>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <form method="POST" action="/reset-password-final" id="resetForm">
            <!-- New Password -->
            <div class="input-group-premium">
                <input type="password" id="password" name="password" class="form-control-premium"
                    placeholder="New Password" required minlength="6">
                <i class="fas fa-key input-icon"></i>
                <i class="fas fa-eye password-toggle" onclick="togglePassword('password', this)"></i>
            </div>

            <!-- Strength Meter -->
            <div class="strength-meter" id="meter-container">
                <div class="strength-bar" id="meter-bar"></div>
            </div>

            <!-- Confirm Password -->
            <div class="input-group-premium">
                <input type="password" id="confirm_password" name="confirm_password" class="form-control-premium"
                    placeholder="Confirm Password" required minlength="6">
                <i class="fas fa-lock input-icon"></i>
                <i class="fas fa-eye password-toggle" onclick="togglePassword('confirm_password', this)"></i>
            </div>

            <button type="submit" class="btn-submit-premium">
                <span>UPDATE PASSWORD</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </form>
    </div>
</div>

<script>
    function togglePassword(inputId, icon) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
    }

    // Password Strength Logic
    const passwordInput = document.getElementById('password');
    const meterContainer = document.getElementById('meter-container');
    const meterBar = document.getElementById('meter-bar');

    passwordInput.addEventListener('input', () => {
        const val = passwordInput.value;
        if (val.length > 0) {
            meterContainer.classList.add('active');
            let strength = 0;
            if (val.length >= 8) strength += 25;
            if (/[A-Z]/.test(val)) strength += 25;
            if (/[0-9]/.test(val)) strength += 25;
            if (/[^A-Za-z0-9]/.test(val)) strength += 25;

            meterBar.style.width = strength + '%';

            if (strength <= 25) meterBar.style.background = '#ef4444';
            else if (strength <= 50) meterBar.style.background = '#f59e0b';
            else if (strength <= 75) meterBar.style.background = '#3b82f6';
            else meterBar.style.background = '#10b981';
        } else {
            meterContainer.classList.remove('active');
            meterBar.style.width = '0';
        }
    });

    // Form submission animation
    const form = document.getElementById('resetForm');
    const btn = form.querySelector('.btn-submit-premium');

    form.addEventListener('submit', (e) => {
        const pass = document.getElementById('password').value;
        const confirm = document.getElementById('confirm_password').value;

        if (pass !== confirm) {
            e.preventDefault();
            alert('Passwords do not match!');
            return;
        }

        btn.innerHTML = '<span>UPDATING...</span><i class="fas fa-spinner fa-spin"></i>';
        btn.style.opacity = '0.8';
        btn.style.pointerEvents = 'none';
    });

    // Hover orbs effect
    document.addEventListener('mousemove', (e) => {
        const orbs = document.querySelectorAll('.orb');
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;

        orbs.forEach((orb, index) => {
            const factor = (index + 1) * 20;
            orb.style.transform = `translate(${x * factor}px, ${y * factor}px)`;
        });
    });
</script>
{% endblock %}